<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controlador-reproductor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controlador-reproductor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const config = require('../config.json').carpetas;
const Cancion = require("./clases/Cancion");
const bot = require('./bot');
const fs = require('fs');

/**
 * Escanea una carpeta en busca de archivos .mp3, y actualiza el archivo de canciones. Solo se llenan las propiedades {@link Cancion}.nombrePersonalizado, {@link Cancion}.ubicacion, y {@link Cancion}.esLocal. El resto se completan con cadenas/vectores vacíos.
 * @param {string} [ruta=config.carpetas.musica] - La ruta que se desea escanear. Si no se coloca, se usa la ruta definida en el archivo de configuración.
 * 
 * @example
 *
 *     escaneoRapidoCanciones("D:\Music\ ");
 */
function escaneoRapidoCanciones(ruta) {
	// Si no se pasó una ruta, usamos la ruta por defecto.
	if (!ruta) {
		ruta = config.musica;
	}
	
	// Obtenemos los archivos de la carpeta.
	var archivos = fs.readdirSync(ruta, {withFileTypes: true});
	
	// Filtramos los archivos, y dejamos los que tienen formato MP3.
	var archivosAudio = archivos.filter( archivo => archivo.name.endsWith(".mp3") );
	
	// Crear las canciones
	var canciones = archivosAudio.map( archivo => new Cancion(archivo.name.substring(0, archivo.name.length - 4), ruta + archivo.name, true, "", "", [], "", "", "") );
	
	// Guardar las canciones
	canciones.forEach( c => c.materializar() );
}

/**
 * Esta función busca las canciones guardadas y las devuelve en forma de un vector.
 * @returns {Cancion[]} Un vector de objetos {@link Cancion}.
 */
function obtenerCancionesGuardadas() {
	var canciones = [];
	var i = 0;
	
	do {
		canciones[i] = new Cancion();
		canciones[i].desmaterializar(i);
		i ++;
	} while (canciones[i - 1].id != undefined);
	
	canciones.pop();
	
	return canciones;
}

/**
 * Realiza el pedido al bot para que reproduzca una canción a partir del id.
 * @param {number} id - El número que identifica a la canción que se quiere reproducir.
 */
function reproducirCancion(id) {
	// Obtenemos la ruta de la canción.
	var cancion = new Cancion();
	cancion.desmaterializar(id);
	
	// Verifica que la canción exista.
	if (cancion.id == undefined) {
		console.log("El id seleccionado no corresponde a ninguna cación. Se abortó la reproducción.");
		return;
	}
	
	// Enviamos la ruta de la canción al bot para que la reproduzca.
	bot.customPlay(cancion.ubicacion, cancion.esLocal);
}

/**
 * Detiene cualquier audio que esté reproduciendo el bot en este momento.
 */
function detenerReproducción() {
	bot.stop();
}

/**
 * Desconecta al bot del canal, y detiene la transmisión de audio si la hay.
 */
function desconectarBot() {
	bot.desconectar();
}

module.exports.escaneoRapidoCanciones = escaneoRapidoCanciones;
module.exports.obtenerCancionesGuardadas = obtenerCancionesGuardadas;
module.exports.reproducirCancion = reproducirCancion;
module.exports.detenerReproducción = detenerReproducción;
module.exports.desconectarBot = desconectarBot;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Cancion.html">Cancion</a></li><li><a href="PantallaReproductor.html">PantallaReproductor</a></li><li><a href="Persistencia.html">Persistencia</a></li></ul><h3>Global</h3><ul><li><a href="global.html#crearListaOrdenada">crearListaOrdenada</a></li><li><a href="global.html#crearVinculo">crearVinculo</a></li><li><a href="global.html#desconectar">desconectar</a></li><li><a href="global.html#desconectarBot">desconectarBot</a></li><li><a href="global.html#detenerReproducci%25C3%25B3n">detenerReproducción</a></li><li><a href="global.html#escaneoRapidoCanciones">escaneoRapidoCanciones</a></li><li><a href="global.html#joinAndPlay">joinAndPlay</a></li><li><a href="global.html#obtenerCancionesGuardadas">obtenerCancionesGuardadas</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#reproducirCancion">reproducirCancion</a></li><li><a href="global.html#stop">stop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Jul 28 2019 17:03:09 GMT-0300 (GMT-03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
